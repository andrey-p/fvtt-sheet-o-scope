(function(s){typeof define=="function"&&define.amd?define(s):s()})(function(){"use strict";var ie=Object.defineProperty;var L=s=>{throw TypeError(s)};var re=(s,n,a)=>n in s?ie(s,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[n]=a;var l=(s,n,a)=>re(s,typeof n!="symbol"?n+"":n,a),M=(s,n,a)=>n.has(s)||L("Cannot "+a);var k=(s,n,a)=>(M(s,n,"read from private field"),a?a.call(s):n.get(s)),p=(s,n,a)=>n.has(s)?L("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(s):n.set(s,a),y=(s,n,a,S)=>(M(s,n,"write to private field"),S?S.call(s,a):n.set(s,a),a),c=(s,n,a)=>(M(s,n,"access private method"),a);var g,w,z,D,m,u,N,T,C,j,V,v,q,B,G,b,d,x,F,_,E,K;var s=(o=>(o.Main="main",o.PopUp="popUp",o))(s||{}),n=(o=>(o.Actor="actor",o.Item="item",o.Journal="journal",o))(n||{});function a(o){return new URL(o).searchParams.get("sheetView")?s.PopUp:s.Main}function S(o){const e=new URL(o).searchParams;if(e.get("sheetView")){const t=e.get("id"),r=e.get("type");if(t&&r&&Object.values(n).includes(r))return{id:t,type:r}}return null}function P(o){console.log(`sheet-o-scope | ${o}`)}function Q(o){console.warn(`sheet-o-scope | ${o}`)}function W(){return game}function $(o,i){var t,r,h,f,H,J;const e=W();if(i===n.Actor)return(r=(t=e.actors)==null?void 0:t.get(o))==null?void 0:r.sheet;if(i===n.Item)return(f=(h=e.items)==null?void 0:h.get(o))==null?void 0:f.sheet;if(i===n.Journal)return(J=(H=e.journal)==null?void 0:H.get(o))==null?void 0:J.sheet}var U=(o=>(o.Reattach="reattach",o))(U||{});class A extends EventTarget{constructor(e=null){super();p(this,w);p(this,g);y(this,g,e),window.addEventListener("message",c(this,w,z).bind(this))}send(e,t){const r={sender:"sheet-o-scope",action:e,data:t};k(this,g)&&k(this,g).postMessage(r)}}g=new WeakMap,w=new WeakSet,z=function(e){if(c(this,w,D).call(this,e)){const t=new MessageEvent("message",{data:e.data});this.dispatchEvent(t)}},D=function(e){const t=e.data;return e.origin===window.location.origin&&t.sender==="sheet-o-scope"};class X{constructor(){l(this,"label","SHEET-O-SCOPE.detach");l(this,"class","sheet-detach");l(this,"icon","fa-solid fa-arrow-right-from-bracket");l(this,"onclick",null)}}class Y extends EventTarget{constructor(){super();p(this,u);p(this,m);y(this,m,new A),Hooks.once("ready",c(this,u,N).bind(this))}}m=new WeakMap,u=new WeakSet,N=function(){var t,r,h;const e=W();if(!((t=e.modules.get("lib-wrapper"))!=null&&t.active)&&((r=e.user)!=null&&r.isGM)){(h=ui.notifications)==null||h.error('Module sheet-o-scope requires the "libWrapper" module. Please install and activate it.');return}P("Setting up changes to main window"),Hooks.on("getActorSheetHeaderButtons",c(this,u,C).bind(this,n.Actor)),Hooks.on("getItemSheetHeaderButtons",c(this,u,C).bind(this,n.Item)),Hooks.on("getJournalSheetHeaderButtons",c(this,u,C).bind(this,n.Journal)),k(this,m).addEventListener("message",c(this,u,T).bind(this))},T=function(e){const t=e.data;t.action===U.Reattach&&c(this,u,V).call(this,t.data)},C=function(e,t,r){const h=new X;h.onclick=()=>{c(this,u,j).call(this,e,t)},r.unshift(h)},j=function(e,t){const{width:r,height:h}=t.options,f=t.document.id;t.close(),window.open(`/game?sheetView=1&id=${f}&type=${e}`,"_blank",`popup=true,width=${r},height=${h}`)},V=function(e){const{id:t,type:r}=e,h=$(t,r);h&&h.render(!0)};class Z{constructor(){l(this,"label","SHEET-O-SCOPE.reattach");l(this,"class","sheet-reattach");l(this,"icon","fa-solid fa-arrow-right-to-bracket");l(this,"onclick",null)}}class ee{constructor(){p(this,v)}run(){const i=c(this,v,q);libWrapper.register("sheet-o-scope","Notifications.prototype.notify",function(e,...t){return i(t)?-1:e(...t)})}}v=new WeakSet,q=function(i){const[e,t]=i;return!!(t==="info"&&e.includes("not displayed because the game Canvas is disabled")||t==="error"&&e.includes("Foundry Virtual Tabletop requires a minimum screen resolution"))};class te{constructor(){p(this,B)}run(){const i=c(this,B,G);libWrapper.register("sheet-o-scope","Application.prototype.render",function(e,...t){return i(this)?this:e(...t)})}}B=new WeakSet,G=function(i){return!!["navigation","sidebar","players","hotbar","pause","controls"].includes(i.options.id)};class ne{run(){libWrapper.register("sheet-o-scope","ClientSettings.prototype.get",function(i,...e){return e.join(".")==="core.noCanvas"?!0:i(...e)})}}const se=[ee,te,ne];class oe{constructor(i){p(this,d);p(this,b);var e;y(this,b,new A(window.opener)),Hooks.once("init",c(this,d,x).bind(this)),Hooks.once("ready",c(this,d,F).bind(this,i)),Hooks.on("getActorSheetHeaderButtons",c(this,d,E).bind(this,n.Actor)),Hooks.on("getItemSheetHeaderButtons",c(this,d,E).bind(this,n.Item)),Hooks.on("getJournalSheetHeaderButtons",c(this,d,E).bind(this,n.Journal)),(e=document.querySelector("body"))==null||e.classList.add("sheet-o-scope-popup")}}b=new WeakMap,d=new WeakSet,x=function(){se.forEach(i=>{new i().run()})},F=function(i){const{id:e,type:t}=i,r=$(e,t);r?(P(`Opening sheet for ${t} with ID: ${e}`),r.render(!0,{minimizable:!1,resizable:!1})):Q(`Couldn't find sheet for ${t} with ID: ${e}`),window.addEventListener("resize",c(this,d,_).bind(this,r))},_=function(i){i&&i.setPosition({width:window.innerWidth,height:window.innerHeight})},E=function(i,e,t){const r=e.document.id;if(!r)return;const h=t.find(H=>H.class==="close");h&&(h.onclick=()=>{window.close()});const f=new Z;f.onclick=()=>{c(this,d,K).call(this,i,r)},t.unshift(f)},K=function(i,e){k(this,b).send(U.Reattach,{id:e,type:i}),window.close()};const I=window.location.toString(),R=a(I),O=S(I);R===s.Main?new Y:R===s.PopUp&&O&&new oe(O),CONFIG.debug.hooks=!0});
